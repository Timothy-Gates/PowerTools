<!DOCTYPE html>
<html>
<!-- start right frame -->
<head>
    <title>ADA Troubleshooter</title>
    ~[wc:commonscripts]
    <link href="/images/css/screen.css" rel="stylesheet" media="screen">
    <link href="/images/css/print.css" rel="stylesheet" media="print">
    <script>
        var powerTools = powerTools || {
                    adaTroubleshooter: {
                        dateEntered: {recordNum:0,prevColor:'grey'},
                        studentInfo: [],
                        dateInfo: [],
                        attPrefs: [],
                        currentDate: {day: 0,month: 0, year: 0},
                        conversionInfo:[],
                        todayInfo:[],
                        /* Retrieve Student info */
                        retrieveStudent: function(){
                            $j.getJSON('/admin/tech/PowerTools/json/adaTroubleshooter/studentinfo.json', function(result){
                                result.pop();
                                powerTools.adaTroubleshooter.studentInfo = result;
                            }).done(function(){
                                powerTools.adaTroubleshooter.retrieveConversion();
                                powerTools.adaTroubleshooter.buildCalendar();
                                <!-- Validates the data that has been brought in and will display any errors in Error Div -->
                                powerTools.adaTroubleshooter.validateAdaAdm();
                            });
                        },
                        /* Retrieve Attendance Conversion information with FTE ID */
                        retrieveConversion: function(){
                            var fteList = [];
                            for(var i=0; i <powerTools.adaTroubleshooter.studentInfo.length; i++){
                                fteList[i] = powerTools.adaTroubleshooter.studentInfo[i].fteId;
                            }
                            $j.getJSON('/admin/tech/PowerTools/json/adaTroubleshooter/conversionInfo.json?fteID=' +
                                    fteList, function(result){
                                result.pop();
                                powerTools.adaTroubleshooter.conversionInfo = result;
                            }).done(function(){
                                powerTools.adaTroubleshooter.displayConversionInfo();
                            });
                        },
                        /* Retrieve attendance preferences from current school in the following indexes:
                         *  0: Count other schools, 1: Present or Absences Counted, 2: Interval Duration
                         *  3: Record Daily? 4: Record Interval? 5: Record Meeting? 6: Record Time? 7: Bridge Direction */
                        retrieveAttendancePrefs: function(){
                            $j.getJSON('/admin/tech/powerTools/json/adaTroubleshooter/attendancePrefs.json', function(result){
                                result.pop();
                                powerTools.adaTroubleshooter.attPrefs = result;
                            }).done(function(){
                                powerTools.adaTroubleshooter.displayAttendancePrefs();
                            });
                        },
                        /* Display student enrollment data from studentInfo.json using index[0] for current enrollment */
                        displayStudent: function(){
                            $j('#studentData').empty();
                            alert(powerTools.adaTroubleshooter.studentInfo[0].fteId);
                            $j('#studentData').append(
                                    '<table class="grid" id="studentTable" style="width:100%"><th colspan="7" align="center">Current Enrollment</th>'+
                                    '<tbody id="studentTableBody">'+
                                    '<tr><td>Entry Date:</td><td><a href="/admin/students/edittransfer1.html?frn=001' + powerTools.adaTroubleshooter.studentInfo[0].dcid + '">'+
                                    powerTools.adaTroubleshooter.studentInfo[0].entryDate + '</a></td></tr>' +
                                    '<tr><td>Exit Date:</td><td><a href="/admin/students/edittransfer1.html?frn=001' + powerTools.adaTroubleshooter.studentInfo[0].dcid + '">'+
                                    powerTools.adaTroubleshooter.studentInfo[0].exitDate + '</a></td></tr>' +
                                    '<tr><td>Grade Level</td><td>' + powerTools.adaTroubleshooter.studentInfo[0].gradeLevel + '</td></tr>' +
                                    '<tr><td>Membership Share</td><td>' + powerTools.adaTroubleshooter.studentInfo[0].membershipShare + '</td></tr>'
                            );
                            if(powerTools.adaTroubleshooter.studentInfo[0].fteId > 0){
                                $j('#studentTableBody').append(
                                        '<tr><td>FTE Name</td><td><div class="tooltip"><a id="currentFteLink" target="_parent">' + powerTools.adaTroubleshooter.studentInfo[0].fteName + '</a>' +
                                        '<span class="tooltiptext"><table id="currentFte" class="grid"><th colspan="2">Conversion Info</th>' +
                                        '<tr><td>Period\\Interval\\Code</td><td>Value</td></tr><tbody id="currentFteBody"></tbody></table></span></div></td></tr>+' +
                                        '<tr><td>Attendance Mode</td><td>' + powerTools.adaTroubleshooter.studentInfo[0].attModeCode + '</td></tr>' +
                                        '<tr><td>Attendance Conversion</td><td>' + powerTools.adaTroubleshooter.studentInfo[0].conversionModeCode + '</td></tr>'
                                );
                            }else{
                                $j('#studentTableBody').append(
                                        '<tr><td>FTE Name</td><td><a href="/admin/students/edittransfer1.html?frn=" + "001" + powerTools.adaTroubleshooter.studentInfo>Click here to set FTE</a>'
                                );
                                powerTools.adaTroubleshooter.displayError("No FTE selected for current enrollment");
                            };
                            $j('#studentTableBody').append(
                                    '</tbody></table>'
                            );
                        },
                        /* Display Conversion Info in current enrollment tooltip */
                        displayConversionInfo: function() {
                            for (var i = 0; i < powerTools.adaTroubleshooter.conversionInfo.length; i++) {
                                if (powerTools.adaTroubleshooter.conversionInfo[i].fteId == powerTools.adaTroubleshooter.studentInfo[0].fteId && powerTools.adaTroubleshooter.conversionInfo[i].conversionModeCode.toLowerCase() == powerTools.adaTroubleshooter.studentInfo[0].conversionModeCode.toLowerCase()) {
                                    $j('#currentFteBody').append(
                                            '<tr><td>' + powerTools.adaTroubleshooter.conversionInfo[i].periodLabel +
                                            '</td><td>' + powerTools.adaTroubleshooter.conversionInfo[i].periodValue + '</td></tr>'
                                    );
                                };
                            };
                            /* Display Conversion Info in previous enrollment tooltips */
                            for(var i=1; i < powerTools.adaTroubleshooter.studentInfo.length; i++){
                                for(var j=0; j < powerTools.adaTroubleshooter.conversionInfo.length; j++){
                                    if(powerTools.adaTroubleshooter.studentInfo[i].fteId == powerTools.adaTroubleshooter.conversionInfo[j].fteId && powerTools.adaTroubleshooter.studentInfo[i].conversionModeCode.toLowerCase() == powerTools.adaTroubleshooter.conversionInfo[j].conversionModeCode.toLowerCase()){
                                        $j('#prevFteBody' + i).append(
                                                '<tr><td>' + powerTools.adaTroubleshooter.conversionInfo[j].periodLabel +
                                                '</td><td>' + powerTools.adaTroubleshooter.conversionInfo[j].periodValue + '</td></tr>'
                                        );
                                    };
                                };
                            };
                        },
                        displayAttendancePrefs: function(){
                            $j('#attPrefData').append(
                                    '<table id="attPrefTable" class="grid"><th colspan="2">Attendance Preferences</th>'+
                                    '<tbody id="attPrefBody"></tbody></table>'
                            );
                            $j('#attPrefBody').append(
                                    '<tr><td>Record Meeting Attendance</td><td>' + Boolean(powerTools.adaTroubleshooter.attPrefs[5].value) + '</td></tr>'+
                                    '<tr><td>Record Daily Attendance</td><td>' + Boolean(powerTools.adaTroubleshooter.attPrefs[3].value) + '</td></tr>'+
                                    '<tr><td>Record Time Attendance</td><td>' + Boolean(powerTools.adaTroubleshooter.attPrefs[6].value) + '</td></tr>'+
                                    '<tr><td>Record Interval Attendance</td><td>' + Boolean(powerTools.adaTroubleshooter.attPrefs[4].value) + '</td></tr>'                            );
                            /*If record interval attendance exists, display interval duration */
                            if(powerTools.adaTroubleshooter.attPrefs[4].value == 1  ){
                                $j('#attPrefBody').append(
                                        '<tr><td>Interval Duration</td><td>' + powerTools.adaTroubleshooter.attPrefs[2].value + '</td></tr>'
                                );
                            };
                            $j('#attPrefBody').append(
                                    '<tr><td>Daily Attendance Bridge Direction</td><td>' + powerTools.adaTroubleshooter.attPrefs[7].value + '</td></tr>'+
                                    '<tr><td>Count Meeting Attendance from Other Schools</td><td>' + Boolean(powerTools.adaTroubleshooter.attPrefs[0].value) + '</td></tr>'
                            );
                            /* if attPrefs[2] == 0, display present, else display absences */
                            if(powerTools.adaTroubleshooter.attPrefs[1].value == 0){
                                $j('#attPrefBody').append('<tr><td>Count Presents or Absences for Attendance Conversion</td><td>Present</td></tr>');
                            }else{
                                $j('#attPrefBody').append('<tr><td>Count Presents or Absences for Attendance Conversion</td><td>Absences</td></tr>');
                            };
                        },
                        <!--Displays the Content of the Legend for reference -->
                        buildLegend: function(){
                            $j('#legend').append(
                                    '<td>Legend:</td><td>Current Day <div class="box yellow" align="center"></div></td>'
                            );
                        },
                        /*Build Calendar and set it to current Month, it will pull the attendance and calendar information for the month, validate that all days exist and that there
                         are no overlapping daily records, and then display all of the information on the calendar with links to daily information*/

                        buildCalendar: function(){
                            $j('#calendarData').empty();
                            var curColor;
                            var tracks;
                            <!-- record start stores the start of the records for the day recordCount tracks the last record for the day-->
                            var recordStart;
                            var recordCount = 0;
                            var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                            var daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
                            <!-- starDate is an object with the first day of the month for the calendar -->
                            var startDate = new Date(powerTools.adaTroubleshooter.currentDate.year,powerTools.adaTroubleshooter.currentDate.month-1, 1);
                            <!-- inMonth 0 means the previous month, 1 means the current month, and 2 means the next month -->
                            var inMonth = 0;
                            <!-- outMonth says which day of the week the last day of the previous month is on -->
                            var outMonth = startDate.getDay() -1;
                            <!-- day shows current day that the calendar is pointing to, if greater than length of month will be reset to 1 -->
                            var day = getDaysInMonth(startDate.getMonth()-1)-outMonth;
                            <!-- first day of the calendar -->
                            var firstDay = new Date(powerTools.adaTroubleshooter.currentDate.month==1?powerTools.adaTroubleshooter.currentDate.year-1:powerTools.adaTroubleshooter.currentDate.year,
                                    outMonth==-1?powerTools.adaTroubleshooter.currentDate.month-1:powerTools.adaTroubleshooter.currentDate.month==1?11:powerTools.adaTroubleshooter.currentDate.month-2,
                                    day > getDaysInMonth(startDate.getMonth()-1)?1:day);
                            firstDay = (firstDay.getMonth()+1) + '/' + firstDay.getDate() + '/' + firstDay.getFullYear();
                            <!-- last day of the calendar -->
                            var lastDay = new Date(powerTools.adaTroubleshooter.currentDate.month==12?powerTools.adaTroubleshooter.currentDate.year+1:powerTools.adaTroubleshooter.currentDate.year,
                                    powerTools.adaTroubleshooter.currentDate.month==12?0:powerTools.adaTroubleshooter.currentDate.month,
                                    17);
                            var meetingArr = [];
                            lastDay = (lastDay.getMonth()+1) + '/' + lastDay.getDate() + '/' + lastDay.getFullYear();
                            $j.ajaxSetup({
                                async: false
                            })
                            $j.getJSON('/admin/tech/PowerTools/json/adaTroubleshooter/calendarinfo.json?startDate=' + firstDay + '&endDate=' + lastDay,function(result){
                                result.pop();
                                powerTools.adaTroubleshooter.dateInfo = result;
                            });
                            $j.ajaxSetup({
                                async: true
                            });
                            $j('#calendarData').append(
                                    '<div style="position:relative; width:100%; max-width:1200px; margin-left:auto; margin-right:auto">' +
                                    '<table class="grid" id="calendar" href="#"><th colspan="7" align=""center">' +
                                    months[powerTools.adaTroubleshooter.currentDate.month -1] + "     " + powerTools.adaTroubleshooter.currentDate.year + '</div></th><tbody>'+
                                    '<tr><td>Sun</td><td>Mon</td><td>Tues</td><td>Wed</td><td>Thurs</td><td>Fri</td><td>Sat</td>'
                            );
                            for(var i=0; i<6; i++){
                                $j('#calendar > tbody:last-child').append(
                                        '</tr><tr>'
                                );
                                for(var j=0;j<7;j++){
                                    recordStart = recordCount;
                                    meetingArr = [];
                                    if(inMonth == 0 && day > getDaysInMonth(startDate.getMonth()-1)){
                                        day = 1;
                                        inMonth = 1;
                                    }
                                    else if(inMonth == 1 && day > getDaysInMonth(startDate.getMonth())){
                                        day = 1;
                                        inMonth = 2;
                                    }
                                    <!-- finds all of the records for this day and checks for duplicate calendar days and duplicate attendance records-->
                                    for(var k = recordCount; k<powerTools.adaTroubleshooter.dateInfo.length; k++){
                                        if(powerTools.adaTroubleshooter.dateInfo[k].date.split('/')[1] != day) {
                                            powerTools.adaTroubleshooter.displayError('invalid calendar, record missing for day: ' +
                                                    powerTools.adaTroubleshooter.dateInfo[k].date.split('/')[0]+
                                                    '/' + day + '/' +
                                                    powerTools.adaTroubleshooter.dateInfo[k].date.split('/')[2]);
                                            day++;
                                            break;
                                        }
                                        if(powerTools.adaTroubleshooter.dateInfo[k+1].date.split('/')[1] != day) {
                                            break;
                                        }
                                        else{
                                            if(powerTools.adaTroubleshooter.dateInfo[k+1].attModeCode == 'daily'){
                                                powerTools.adaTroubleshooter.displayError('Duplicate daily attendance for:' + powerTools.adaTroubleshooter.dateInfo[k+1].date);
                                            }
                                            for(var l = 0; l < meetingArr.length; l++){
                                                if(powerTools.adaTroubleshooter.dateInfo[k+1].expression == meetingArr[l]){
                                                    powerTools.adaTroubleshooter.displayError('Duplicate meeting attendance for: ' + powerTools.adaTroubleshooter.dateInfo[k+1].date);
                                                }
                                                else if(l == meetingArr.length-1){
                                                    meetingArr.push(powerTools.adaTroubleshooter.dateInfo[k+1].expression);
                                                    break;
                                                }
                                            }
                                            recordCount++;
                                        }
                                    }
                                    curColor = setColor(recordStart);
                                    replaceEmptyStrings(powerTools.adaTroubleshooter.dateInfo[i]);
                                    if(inMonth == 1 && powerTools.adaTroubleshooter.currentDate.day == day)
                                    {
                                        powerTools.adaTroubleshooter.dateEntered.recordNum = recordStart+ 'record' + recordCount;
                                        powerTools.adaTroubleshooter.dateEntered.prevColor = curColor;
                                        curColor = 'yellow';
                                        powerTools.adaTroubleshooter.displayDayInformation();
                                        powerTools.adaTroubleshooter.displayStudent();
                                        powerTools.adaTroubleshooter.displayPreviousEnrollments();
                                        powerTools.adaTroubleshooter.populateEnrollmentLinks();
                                    }
                                    for(var k = 0, tracksString ='', len = powerTools.adaTroubleshooter.dateInfo[recordStart].tracks.length; k < len; k++){
                                        tracksString = tracksString.concat(powerTools.adaTroubleshooter.dateInfo[recordStart].tracks[k])
                                        if(k == len-1){
                                            tracks = tracksString;
                                        }
                                    }

                                    $j('#calendar > tbody:last-child').append(
                                            '<td class="square" id ="'+recordStart+ 'record' + recordCount + '"  style="background-color:'+ curColor +'">' +
                                            '<div style="width:50%; float:left">' + day + '</div><div style="width:50%; float:left" align="right">' + powerTools.adaTroubleshooter.dateInfo[recordStart].attCode+ '</div>' +
                                            '<div style="width:50%; float:left">Ada: ' + powerTools.adaTroubleshooter.dateInfo[recordStart].adaValueCode + '</div><div style="width:50%; float:left">Adm: ' + powerTools.adaTroubleshooter.dateInfo[recordStart].admValue + '</div>' +
                                            '<div style="width:100%; float:left">Bell: ' + powerTools.adaTroubleshooter.dateInfo[recordStart].bellScheduleName + '</div>' +
                                            '<div style="width:100%; float:left">Track: ' + tracks + '</div>' +
                                            '</td>'
                                    );
                                    day++;
                                    recordCount++;
                                }
                            }
                            $j('#calendarData > tbody:last-child').append(
                                    '</tr></tbody></table></div>'
                            );
                            <!-- Sets the color of the square for the day inEnrollment: 0=current 1=previous 2=never -->
                            function setColor(record){
                                var inEnrollment = 0;
                                var cellColor;
                                if(new Date(powerTools.adaTroubleshooter.dateInfo[record].date) < new Date(powerTools.adaTroubleshooter.studentInfo[0].entryDate) ||
                                        new Date(powerTools.adaTroubleshooter.dateInfo[record].date) > new Date(powerTools.adaTroubleshooter.studentInfo[0].exitDate)){
                                    for(var i = 1; i < powerTools.adaTroubleshooter.studentInfo.length; i++){
                                        if(new Date(powerTools.adaTroubleshooter.dateInfo[record].date) >= new Date(powerTools.adaTroubleshooter.studentInfo[i].entryDate) &&
                                                new Date(powerTools.adaTroubleshooter.dateInfo[record].date) <= new Date(powerTools.adaTroubleshooter.studentInfo[i].exitDate)){
                                            inEnrollment = 1;
                                        }
                                    }
                                    if(inEnrollment == 1) {
                                        cellColor = 'lightGrey';
                                    }
                                    else {
                                        cellColor = 'grey';
                                        inEnrollment = 2;
                                    }
                                }
                                if(powerTools.adaTroubleshooter.dateInfo[record].inSession == 1 && inEnrollment !=2){
                                    if(powerTools.adaTroubleshooter.dateInfo[record].attCode =='')
                                    {
                                        if(inEnrollment == 0){
                                            cellColor = 'green';
                                        }
                                        else {
                                            cellColor = 'lightGreen';
                                        }
                                    }
                                    else {
                                        if(inEnrollment == 0){
                                            cellColor = 'red';
                                        }
                                        else {
                                            cellColor = 'pink';
                                        }
                                    }
                                }
                                else if(powerTools.adaTroubleshooter.dateInfo[record].inSession == 0 && inEnrollment !=2){
                                    cellColor = 'lightBlue';
                                }
                                return cellColor;
                            }
                            <!-- Returns the days in the month, accounts for leap years and previous years if january -->
                            function getDaysInMonth(month)
                            {
                                if(month == 1)
                                {
                                    if(powerTools.adaTroubleshooter.currentDate.year %4 == 0 && powerTools.adaTroubleshooter.currentDate.year % 100 != 0 ||
                                            powerTools.adaTroubleshooter.currentDate.year % 400 == 0) {
                                        return 29;
                                    }
                                }
                                else if(month == -1){
                                    return 31;
                                }
                                return daysInMonth[month];
                            }
                            function replaceEmptyStrings(record){
                                if(record.inSession == 1) {
                                    if (record.attCode == '') {
                                        record.stuff = '';
                                    }
                                    if (record.stuff == '') {
                                        record.stuff = '';
                                    }
                                    if (record.stuff == '') {
                                        record.stuff = '';
                                    }
                                    if (record.stuff == '') {
                                        record.stuff = '';
                                    }
                                    if (record.stuff == '') {
                                        record.stuff = '';
                                    }
                                    if (record.stuff == '') {
                                        record.stuff = '';
                                    }
                                }
                            }
                        },
                        <!-- Display's the daily information for the student based on the date selected on the calendar -->
                        displayDayInformation: function(){
                            var daily = true;
                            var meeting = true;
                            var time = true;
                            var interval = true;
                            var curRecord = powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[0];
                            $j('#dayInformation').empty();
                            $j('#dayInformation').append(
                                    '<table class="grid" id="dayTable" style="width:100%"><th colspan=2>Ada/Adm information for: ' + powerTools.adaTroubleshooter.dateInfo[curRecord].date + '</th><tbody>'
                            );
                            $j('#dayTable').append(
                                    '<tr><td>Daily ADA Value:</td><td>' + powerTools.adaTroubleshooter.dateInfo[curRecord].adaValueCode + '</td></tr>' +
                                    '<tr><td>Daily ADM Value</td><td>' + powerTools.adaTroubleshooter.dateInfo[curRecord].membershipValue +'</td></tr>'
                            );
                            $j('#dayTable').append(
                                    '</tbody</table>'
                            );
                            if(daily){
                                $j('#dayInformation').append(
                                        '<table class="grid" id="dailyTable" style="width:100%"><th colspan=3>Daily Record Information</th><tbody>'
                                );
                                $j('#dailyTable').append(
                                        '<th>Code</th><th>Counts Ada</th><th>Counts Adm</th>' +
                                        '<tr><td>' + powerTools.adaTroubleshooter.dateInfo[curRecord].attCode + '</td><td>' + powerTools.adaTroubleshooter.dateInfo[curRecord].countsInAda + '</td><td>' + powerTools.adaTroubleshooter.dateInfo[curRecord].countsInAdm + '</td></tr>'
                                );
                                $j('#dailyTable').append(
                                        '</tbody</table>'
                                );
                            }
                            if(meeting){
                                $j('#dayInformation').append(
                                        '<table class="grid" id="meetingTable" style="width:100%"><th colspan=3>Meeting Attendance Records</th><tbody>'
                                );
                                for(var i = powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[0]+1; i <= powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[1]; i++) {
                                    $j('#meetingTable').append(
                                            '<th>Code</th><th>Counts Ada</th><th>Counts Adm</th>' +
                                            '<tr><td>' + powerTools.adaTroubleshooter.dateInfo[i].attCode + '</td><td>' + powerTools.adaTroubleshooter.dateInfo[i].countsInAda + '</td><td>' + powerTools.adaTroubleshooter.dateInfo[i].countsInAdm + '</td></tr>'
                                    );
                                }
                                $j('#meetingTable').append(
                                        '</tbody</table>'
                                );
                            }
                            if(time){
                                $j('#dayInformation').append(
                                        '<table class="grid" id="timeTable" style="width:100%"><th colspan=3>Time Attendance Records</th><tbody>'
                                );
                                for(var i = powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[0]+1; i <= powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[1]; i++) {
                                    $j('#timeTable').append(
                                            '<th>Code</th><th>Counts Ada</th><th>Counts Adm</th>' +
                                            '<tr><td>' + powerTools.adaTroubleshooter.dateInfo[i].attCode + '</td><td>' + powerTools.adaTroubleshooter.dateInfo[i].countsInAda + '</td><td>' + powerTools.adaTroubleshooter.dateInfo[i].countsInAdm + '</td></tr>'
                                    );
                                }
                                $j('#timeTable').append(
                                        '</tbody</table>'
                                );
                            }
                            if(interval){
                                $j('#dayInformation').append(
                                        '<table class="grid" id="intervalTable" style="width:100%"><th colspan=3>Interval Attendance Records</th><tbody>'
                                );
                                for(var i = powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[0]+1; i <= powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[1]; i++) {
                                    $j('#intervalTable').append(
                                            '<th>Code</th><th>Counts Ada</th><th>Counts Adm</th>' +
                                            '<tr><td>' + powerTools.adaTroubleshooter.dateInfo[i].attCode + '</td><td>' + powerTools.adaTroubleshooter.dateInfo[i].countsInAda + '</td><td>' + powerTools.adaTroubleshooter.dateInfo[i].countsInAdm + '</td></tr>'
                                    );
                                }
                                $j('#intervalTable').append(
                                        '</tbody</table>'
                                );
                            }
                        },
                        displayPreviousEnrollments: function(){
                            $j('#prevEnrollmentData').empty();
                            /* Display student previous enrollment data if it exists using index > '0'*/
                            if(powerTools.adaTroubleshooter.studentInfo.length > 1) {
                                $j('#prevEnrollmentData').append(

                                        '<table class="grid" id="studentPrevTable"><th colspan="7" align="center">Previous Enrollments</th>' +
                                        '<tr><td>Entry Date:</td><td>Exit Date:</td><td>Grade Level</td><td>Membership Share</td>' +
                                        '<td>FTE Name</td><td>Attendance Mode</td><td>Attendance Conversion</td></tr>' +
                                        '<tbody id="studentPrevTableBody"></tbody></table>'
                                );
                                for (var i = 1; i < powerTools.adaTroubleshooter.studentInfo.length; i++) {
                                    $j('#studentPrevTableBody').append(
                                            '<tr><td><a href="/admin/students/edittransfer2.html?frn=018' + powerTools.adaTroubleshooter.studentInfo[i].dcid + '">'+
                                            powerTools.adaTroubleshooter.studentInfo[i].entryDate + '</a></td>' +
                                            '<td><a href="/admin/students/edittransfer2.html?frn=018' + powerTools.adaTroubleshooter.studentInfo[i].dcid + '">'+
                                            powerTools.adaTroubleshooter.studentInfo[i].exitDate + '</a></td>' +
                                            '<td>' + powerTools.adaTroubleshooter.studentInfo[i].gradeLevel + '</td>' +
                                            '<td>' + powerTools.adaTroubleshooter.studentInfo[i].membershipShare + '</td>' +
                                            '<td><div class="tooltip"><a id="prevFteLink' + i + '" target="_parent" href="/admin/attendance/conversions/home.html">' + powerTools.adaTroubleshooter.studentInfo[i].fteName + '</a><span class="tooltiptext"><table id="prevFte' + i + '" class="grid"><th colspan="2">Conversion Info</th>'+
                                            '<tr><td>Period\\Interval\\Code</td><td>Value</td></tr><tbody id="prevFteBody' + i + '" </tbody></table></span></div></td>' +
                                            '<td>' + powerTools.adaTroubleshooter.studentInfo[i].attModeCode + '</td>' +
                                            '<td>' + powerTools.adaTroubleshooter.studentInfo[i].conversionModeCode + '</td></tr>'
                                    );
                                };
                            };
                        },
                        populateEnrollmentLinks: function(){
                            /* Create Anchor href for current enrollment */
                            var curRecord = powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[0];
                            if(new Date(powerTools.adaTroubleshooter.dateInfo[curRecord].date) >= new Date(powerTools.adaTroubleshooter.studentInfo[0].entryDate) && new Date(powerTools.adaTroubleshooter.studentInfo[0].exitDate) >= new Date(powerTools.adaTroubleshooter.dateInfo[curRecord].date)){
                                /* dateEntered within Current Enrollment, create anchor href for editing current FTE */
                                $j('#currentFteLink').attr('href','/admin/attendance/conversions/'+
                                        powerTools.adaTroubleshooter.studentInfo[0].conversionModeCode + '/home.html?id='+
                                        powerTools.adaTroubleshooter.dateInfo[curRecord].attConversionId+
                                        '&fte=' + powerTools.adaTroubleshooter.studentInfo[0].fteId
                                );
                            }else {
                                /* no current enrollments, create default anchor href for editing fte */
                                $j('#currentFteLink').attr('href', '/admin/attendance/conversions/home.html');
                            }
                        },
                        validateAdaAdm: function(){
                            <!-- Check that there are no overlapping enrollments -->
                            var dateArr = [];
                            var dateObj = {date:0, record:0}
                            var temp;
                            for(var i = 0; i < powerTools.adaTroubleshooter.studentInfo.length; i++){
                                dateObj.date = new Date(powerTools.adaTroubleshooter.studentInfo[i].entryDate);
                                dateObj.record = i;
                                dateArr.push(dateObj);
                                dateObj.date = new Date(powerTools.adaTroubleshooter.studentInfo[i].exitDate);
                                dateObj.record +=.5;
                                dateArr.push(dateObj);
                                if(powerTools.adaTroubleshooter.studentInfo[i].fteId == ''){
                                    displayError('Student fte is blank for: 0 '+ powerTools.adaTroubleshooter.studentInfo[i].entryDate);
                                    <!-- do stuff -->
                                }
                            }
                            <!-- Insertion sort -->
                            for(var i = 0; i < dateArr.length; i++){
                                temp = dateArr[i];
                                for(var j = i-1; j >=0 && (dateArr[j].date.getTime() < temp.date.getTime()); j--){
                                    dateArr[j+1] = dateArr[j];
                                }
                                dateArr[j+1] = temp;
                            }
                            for(var i = 1; i < dateArr.length; i++){
                                if(dateArr[i-1].record > dateArr[i].record){
                                    if(Math.floor(dateArr[i-1].record) == Math.floor(dateArr[i].record)){
                                        powerTools.adaTroubleshooter.displayError('Entry Date is after the Exit date for: ' + dateArr[i].date);
                                    }
                                    else{
                                        powerTools.adaTroubleshooter.displayError('Overlapping enrollments for: ' + dateArr[i].date + ' and ' + dateArr[i-1]);
                                    }
                                }
                            }
                            <!-- Replace all blanks with appropriate value -->
                        },
                        displayError: function(error){
                            $j('#error').append(
                                    '<table class="linkDescList"><tbody><th style="color:red">' + error + '</th></tbody></table>'
                            );
                        },
                    }
                };
        $j(document).ready(function(){
            var today = new Date();
            powerTools.adaTroubleshooter.currentDate.day = today.getDate();
            powerTools.adaTroubleshooter.currentDate.month = today.getMonth() +1;
            powerTools.adaTroubleshooter.currentDate.year = today.getFullYear();
            powerTools.adaTroubleshooter.retrieveStudent();
            powerTools.adaTroubleshooter.retrieveAttendancePrefs();
            powerTools.adaTroubleshooter.buildLegend();
            $j('#dateSelector').on('change', function () {
                var selectedDate = $j('#dateSelector').val().split("/");
                powerTools.adaTroubleshooter.currentDate.month = selectedDate[0];
                powerTools.adaTroubleshooter.currentDate.day = selectedDate[1];
                powerTools.adaTroubleshooter.currentDate.year = selectedDate[2];
                powerTools.adaTroubleshooter.buildCalendar();
            });
            $j(document).on('click', '.square', function(){
                $j('#' + powerTools.adaTroubleshooter.dateEntered.recordNum).attr('style', 'background-color:' +
                        powerTools.adaTroubleshooter.dateEntered.prevColor);
                powerTools.adaTroubleshooter.dateEntered.recordNum = $j(this).attr('id');
                powerTools.adaTroubleshooter.dateEntered.prevColor = $j(this).attr('style').split(':')[1];
                $j(this).attr('style', 'background-color: yellow');
                powerTools.adaTroubleshooter.displayDayInformation();
                powerTools.adaTroubleshooter.displayStudent();
                powerTools.adaTroubleshooter.displayPreviousEnrollments();
                powerTools.adaTroubleshooter.populateEnrollmentLinks();
            });
        });

    </script>
    <style>
        .square {
            width: 14.28%;
            padding-bottom:5.03%;
        }
        .box{
            float: left;
            width: 20px;
            height: 20px;
            margin: 5px;
            border: 1px solid rgba(0,0,0,.2);
        }
        .yellow{
            background: yellow;
        }
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px black;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #000;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            top: 1%;
            left: 225%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 1s;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
~[wc:admin_header_frame_css]
<!-- breadcrumb start -->
<a href="/admin/home.html" target="_top">~[text:psx.html.admin_students.honorroll.start_page]</a>
&gt; <a href="home.html?selectstudent=nosearch" target="_top">~[text:psx.html.admin_students.honorroll.student_selection]</a>
&gt;~[text:psx.html.admin_students.honorroll.honor_roll1]
<!-- breadcrumb end -->
~[wc:admin_navigation_frame_css] ~[wc:title_student_begin_css]ADA Troubleshooter~[wc:title_student_end_css]
<!-- start of content and bounding box -->
<div class="box-round">
    <div id="dateSelection">
        <table class="linkDescList">
            <tb><p><b>This utility will help to determine how Average Daily Attendance and Membership are calculated, should the attendance views
                be updated. If the data your are displaying on this page does not match the ADA/ADM reports, try <a href="/admin/reports_engine/report_w_param.html?ac=reports_get_using_ID;repo_ID=ATT_RefreshPremierMembrDefaults">refreshing
                    the Premier Attendance Views Data</a>.
            </b></p></tb>
        </table>
    </div>
    <div id="error"></div>
    <div id="studentAndDailyTables">
        <table>
            <td style="width:50%"><div id="studentData" ></div></td>
            <td style="width:50%"><div id="dayInformation" ></div></td>
        </table>
    </div>
    <div id="attPrefData"></div>
    <div id="calendarData" align="center"></div>
    <div id="prevEnrollmentData"></div>
    <div id="calendarLegend">
        <table class="linkDescList"><th colspn =3>Pick A Date<input id="dateSelector" type="text" class="psDateWidget" /></th>
            <tr id="legend"></tr>
        </table>
    </div>
</div>
<!-- end of content of bounding box -->
~[wc:admin_footer_frame_css]
</body>
</html>
<!-- end right frame -->


