<!DOCTYPE html>
<html>
<!-- start right frame -->
<head>
    <title>ADA Troubleshooter</title>
    ~[wc:commonscripts]
    <link href="/images/css/screen.css" rel="stylesheet" media="screen">
    <link href="/images/css/print.css" rel="stylesheet" media="print">
    <script>
        var powerTools = powerTools || {
                    adaTroubleshooter: {
                        dateEntered: {recordNum:0,prevColor:'grey'},
                        studentInfo: [],
                        fteInfo: {},
                        dateInfo: [],
                        attPrefs: [],
                        currentDate: {day: 0,month: 0, year: 0},
                        conversionInfo:{},
                        /* Retrieve Student info */
                        retrieveStudent: function(){
                            $j.getJSON('/admin/tech/PowerTools/json/adaTroubleshooter/studentinfo.json', function(result){
                                result.pop();
                                powerTools.adaTroubleshooter.studentInfo = result;
                            }).done(function(){
                                powerTools.adaTroubleshooter.displayStudent();
                                powerTools.adaTroubleshooter.displayPreviousEnrollments();
                                powerTools.adaTroubleshooter.retrieveConversion();
                            });
                        },
                        /* Retrieve Attendance Conversion information with FTE ID */
                        retrieveConversion: function(){
                            var fteList = [];
                            for(var i=0; i <powerTools.adaTroubleshooter.studentInfo.length; i++){
                                fteList[i] = powerTools.adaTroubleshooter.studentInfo[i].fteId;
                            }
                            $j.getJSON('/admin/tech/PowerTools/json/adaTroubleshooter/conversionInfo.json?fteID=' +
                                    fteList, function(result){
                                result.pop();
                                powerTools.adaTroubleshooter.conversionInfo = result;
                            }).done(function(){
                                powerTools.adaTroubleshooter.displayConversionInfo();
                            });
                        },
                        /* Retrieve attendance preferences from current school */
                        retrieveAttendancePrefs: function(){
                            $j.getJSON('/admin/tech/powerTools/json/adaTroubleshooter/attendancePrefs.json', function(result){
                                result.pop();
                                powerTools.adaTroubleshooter.attPrefs = result;
                            }).done(function(){
                                powerTools.adaTroubleshooter.displayAttendancePrefs();
                            });
                        },
                        /* Display student enrollmnet data from studentInfo.json using index[0] for current enrollment */
                        displayStudent: function(){
                            $j('#studentData').append(
                                    '<table class="grid" id="studentTable" style="width:100%"><th colspan="7" align="center">Current Enrollment</th>'+
                                    '<tbody id="studentTableBody">'+
                                    '<tr><td>Entry Date:</td><td><a href="/admin/students/edittransfer1.html?frn=001' + powerTools.adaTroubleshooter.studentInfo[0].dcid + '">'+
                                        powerTools.adaTroubleshooter.studentInfo[0].entryDate + '</a></td></tr>' +
                                    '<tr><td>Exit Date:</td><td><a href="/admin/students/edittransfer1.html?frn=001' + powerTools.adaTroubleshooter.studentInfo[0].dcid + '">'+
                                        powerTools.adaTroubleshooter.studentInfo[0].exitDate + '</a></td></tr>' +
                                    '<tr><td>Grade Level</td><td>' + powerTools.adaTroubleshooter.studentInfo[0].gradeLevel + '</td></tr>' +
                                    '<tr><td>Membership Share</td><td>' + powerTools.adaTroubleshooter.studentInfo[0].membershipShare + '</td></tr>'+
                                    '<tr><td>FTE Name</td><td><div class="tooltip">' + powerTools.adaTroubleshooter.studentInfo[0].fteName +
                                        '<span class="tooltiptext"><table id="currentFte" class="grid"><th colspan="2">Conversion Info</th>'+
                                            '<tr><td>Period\\Interval\\Code</td><td>Value</td></tr><tbody id="currentFteBody"></tbody></table></span></div></td></tr>'+
                                    '<tr><td>Attendance Mode</td><td>' + powerTools.adaTroubleshooter.studentInfo[0].attModeCode + '</td></tr>' +
                                    '<tr><td>Attendance Conversion</td><td>' + powerTools.adaTroubleshooter.studentInfo[0].conversionModeCode + '</td></tr>'+
                                    '</tbody></table>'
                            );
                        },
                        /* LINK INFO TO BE ANCHORED TO FTE NAMES
                         '<tr><td>FTE Name</td><td><div class="tooltip"><a href="/admin/attendance/conversions/'+
                         powerTools.adaTroubleshooter.studentInfo[0].conversionModeCode + '/home.html?id='+
                         powerTools.adaTroubleshooter.calendarInfo[powerTools.adaTroubleshooter.dateInfo.recordNum].attConversionID +
                         '&fteid=' + powerTools.adaTroubleshooter.studentInfo[0].fteID + '">' + powerTools.adaTroubleshooter.studentInfo[0].fteName + '</a>'+
                         '<span class="tooltiptext"><table id="currentFte" class="grid"><th colspan="2">Conversion Info</th>'+
                         '<tr><td>Period\\Interval\\Code</td><td>Value</td></tr><tbody id="currentFteBody"></tbody></table></span></div></td></tr>'+
                         */
                        /* Display Conversion Info in current enrollment tooltip */
                        displayConversionInfo: function() {
                            for (var i = 0; i < powerTools.adaTroubleshooter.conversionInfo.length; i++) {
                                if (powerTools.adaTroubleshooter.conversionInfo[i].fteId == powerTools.adaTroubleshooter.studentInfo[0].fteId && powerTools.adaTroubleshooter.conversionInfo[i].conversionModeCode.toLowerCase() == powerTools.adaTroubleshooter.studentInfo[0].conversionModeCode.toLowerCase()) {
                                    $j('#currentFteBody').append(
                                            '<tr><td>' + powerTools.adaTroubleshooter.conversionInfo[i].periodLabel +
                                            '</td><td>' + powerTools.adaTroubleshooter.conversionInfo[i].periodValue + '</td></tr>'
                                    );
                                };
                            };
                            /* Display Conversion Info in previous enrollment tooltips */
                            for(var i=1; i < powerTools.adaTroubleshooter.studentInfo.length; i++){
                                for(var j=0; j < powerTools.adaTroubleshooter.conversionInfo.length; j++){
                                    if(powerTools.adaTroubleshooter.studentInfo[i].fteId == powerTools.adaTroubleshooter.conversionInfo[j].fteId && powerTools.adaTroubleshooter.studentInfo[i].conversionModeCode.toLowerCase() == powerTools.adaTroubleshooter.conversionInfo[j].conversionModeCode.toLowerCase()){
                                        $j('#prevFteBody' + i).append(
                                                '<tr><td>' + powerTools.adaTroubleshooter.conversionInfo[j].periodLabel +
                                                '</td><td>' + powerTools.adaTroubleshooter.conversionInfo[j].periodValue + '</td></tr>'
                                        );
                                    };
                                };
                            };
                        },
                        displayAttendancePrefs: function(){
                            $j('#attPrefData').append(
                                    '<table id="attPrefTable" class="grid"><th colspan="2">Attendance Preferences</th>'+
                                    '<tr><td>Pref Name</td><td>Value</td></tr><tbody id="attPrefBody"></tbody></table>'
                            );
                            for(var i=0; i < powerTools.adaTroubleshooter.attPrefs.length; i++){
                                $j('#attPrefBody').append(
                                        '<tr><td>' + powerTools.adaTroubleshooter.attPrefs[i].name+'</td><td>' + powerTools.adaTroubleshooter.attPrefs[i].value + '</td></tr>'
                                );
                            };
                        },
                        <!--Displays the Content of the Legend for reference -->
                        buildLegend: function(){
                            $j('#legend').append(
                                    '<td>Legend:</td><td>Current Day <div class="box yellow" align="center"></div></td>'
                            );
                        },
                        <!--Build Calendar and set it to current Month -->
                        buildCalendar: function(){
                            $j('#calendarData').empty();
                            var curColor;
                            <!-- record start stores the start of the records for the day recordCount tracks the last record for the day-->
                            var recordStart;
                            var recordCount = 0;
                            var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                            var daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
                            <!-- starDate is an object with the first day of the month for the calendar -->
                            var startDate = new Date(powerTools.adaTroubleshooter.currentDate.year,powerTools.adaTroubleshooter.currentDate.month-1, 1);
                            <!-- inMonth 0 means the previous month, 1 means the current month, and 2 means the next month -->
                            var inMonth = 0;
                            <!-- outMonth says which day of the week the last day of the previous month is on -->
                            var outMonth = startDate.getDay() -1;
                            <!-- day shows current day that the calendar is pointing to, if greater than length of month will be reset to 1 -->
                            var day = getDaysInMonth(startDate.getMonth()-1)-outMonth;
                            <!-- first day of the calendar -->
                            var firstDay = new Date(powerTools.adaTroubleshooter.currentDate.month==1?powerTools.adaTroubleshooter.currentDate.year-1:powerTools.adaTroubleshooter.currentDate.year,
                                                     outMonth==-1?powerTools.adaTroubleshooter.currentDate.month-1:powerTools.adaTroubleshooter.currentDate.month==1?11:powerTools.adaTroubleshooter.currentDate.month-2,
                                                     day > getDaysInMonth(startDate.getMonth()-1)?1:day);
                            firstDay = (firstDay.getMonth()+1) + '/' + firstDay.getDate() + '/' + firstDay.getFullYear();
                            <!-- last day of the calendar -->
                            var lastDay = new Date(powerTools.adaTroubleshooter.currentDate.month==12?powerTools.adaTroubleshooter.currentDate.year+1:powerTools.adaTroubleshooter.currentDate.year,
                                                    powerTools.adaTroubleshooter.currentDate.month==12?0:powerTools.adaTroubleshooter.currentDate.month,
                                                    17);
                            lastDay = (lastDay.getMonth()+1) + '/' + lastDay.getDate() + '/' + lastDay.getFullYear();
                            $j.ajaxSetup({
                                async: false
                            })
                            $j.getJSON('/admin/tech/PowerTools/json/adaTroubleshooter/calendarinfo.json?startDate=' + firstDay + '&endDate=' + lastDay,function(result){
                                result.pop();
                                powerTools.adaTroubleshooter.dateInfo = result;
                            });
                            $j.ajaxSetup({
                                async: true
                            });
                            $j('#calendarData').append(
                                  '<table class="grid" id="calendar" href="#" style="max-width:1200px"><th colspan="7" align=""center">' +
                                  months[powerTools.adaTroubleshooter.currentDate.month -1] + "     " + powerTools.adaTroubleshooter.currentDate.year + '</div></th><tbody>'+
                                  '<tr><td>Sun</td><td>Mon</td><td>Tues</td><td>Wed</td><td>Thurs</td><td>Fri</td><td>Sat</td>'
                            );
                            for(var i=0; i<6; i++){
                                $j('#calendar > tbody:last-child').append(
                                        '</tr><tr>'
                                );
                                for(var j=0;j<7;j++){
                                    recordStart = recordCount;
                                    if(inMonth == 0 && day > getDaysInMonth(startDate.getMonth()-1)){
                                        day = 1;
                                        inMonth = 1;
                                    }
                                    else if(inMonth == 1 && day > getDaysInMonth(startDate.getMonth())){
                                        day = 1;
                                        inMonth = 2;
                                    }
                                    <!-- finds all of the records for this day -->
                                    for(var k = recordCount; k<powerTools.adaTroubleshooter.dateInfo.length; k++){
                                        if(powerTools.adaTroubleshooter.dateInfo[k].date.split('/')[1] != day) {
                                            console.log("invalid calendar");
                                        }
                                        if(powerTools.adaTroubleshooter.dateInfo[k+1].date.split('/')[1] != day) {
                                            break;
                                        }
                                        else{
                                            recordCount++;
                                        }
                                    }
                                    if(powerTools.adaTroubleshooter.dateInfo[recordStart].inSession ==1){
                                        curColor = 'green';
                                    }
                                    else{
                                        curColor = 'grey';
                                    }
                                    if(inMonth == 1 && powerTools.adaTroubleshooter.currentDate.day == day)
                                    {
                                        powerTools.adaTroubleshooter.dateEntered.recordNum = recordStart+ 'record' + recordCount;
                                        powerTools.adaTroubleshooter.dateEntered.prevColor = curColor;
                                        curColor = 'yellow';
                                        powerTools.adaTroubleshooter.displayDayInformation();
                                    }
                                    $j('#calendar > tbody:last-child').append(
                                            '<td class="square" id ="'+recordStart+ 'record' + recordCount + '"  style="background-color:'+ curColor +'">' + day + "  " + powerTools.adaTroubleshooter.dateInfo[recordStart].membershipValue+ '</td>'
                                    );
                                    console.log(recordStart+ 'record' + recordCount);
                                    day++;
                                    recordCount++;
                                }
                            }
                            $j('#calendarData > tbody:last-child').append(
                                  '</tr></tbody></table>'
                            );
                            <!-- Returns the days in the month, accounts for leap years and previous years if january -->
                            function getDaysInMonth(month)
                            {
                                if(month == 1)
                                {
                                    if(powerTools.adaTroubleshooter.currentDate.year %4 == 0 && powerTools.adaTroubleshooter.currentDate.year % 100 != 0 ||
                                            powerTools.adaTroubleshooter.currentDate.year % 400 == 0) {
                                        return 29;
                                    }
                                }
                                else if(month == -1){
                                    return 31;
                                }
                                return daysInMonth[month];
                            }

                        },
                        <!-- Display's the daily information for the student based on the date selected on the calendar -->
                        displayDayInformation: function(){
                            var daily = true;
                            var meeting = true;
                            var time = true;
                            var interval = true;
                            var curRecord = powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[0];
                            var attCode = powerTools.adaTroubleshooter.dateInfo[curRecord].attCode == ''?'Present': powerTools.adaTroubleshooter.dateInfo[curRecord].attCode;
                            if(powerTools.adaTroubleshooter.dateInfo[curRecord].inSession== 0){
                                attCode = 'Not in Session';
                            }
                            $j('#dayInformation').empty();
                            $j('#dayInformation').append(
                                    '<table class="grid" id="dayTable" style="width:100%"><th colspan=2>Ada/Adm information for: ' + powerTools.adaTroubleshooter.dateInfo[curRecord].date + '</th><tbody>'
                            );
                            $j('#dayTable').append(
                                    '<tr><td>Daily ADA Value:</td><td>' + powerTools.adaTroubleshooter.dateInfo[curRecord].adaValueCode + '</td></tr>' +
                                    '<tr><td>Daily ADM Value</td><td>' + powerTools.adaTroubleshooter.dateInfo[curRecord].membershipValue +'</td></tr>'
                            );
                            $j('#dayTable').append(
                                    '</tbody</table>'
                            );
                            if(daily){
                                $j('#dayInformation').append(
                                        '<table class="grid" id="dailyTable" style="width:100%"><th colspan=2>Daily Record Information</th><tbody>'
                                );
                                $j('#dailyTable').append(
                                        '<tr><td>Student AttendanceCode</td><td>' + attCode + '</td></tr>'
                                );
                                $j('#dailyTable').append(
                                        '</tbody</table>'
                                );
                            }
                            if(meeting){
                                $j('#dayInformation').append(
                                        '<table class="grid" id="meetingTable" style="width:100%"><th colspan=2>Meeting Attendance Records</th><tbody>'
                                );
                                for(var i = powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[0]+1; i <= powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[1]; i++) {
                                    $j('#meetingTable').append(
                                            '<tr><td>Student AttendanceCode</td><td>' + attCode + '</td></tr>'
                                    );
                                }
                                $j('#meetingTable').append(
                                        '</tbody</table>'
                                );
                            }
                            if(time){
                                $j('#dayInformation').append(
                                        '<table class="grid" id="timeTable" style="width:100%"><th colspan=2>Time Attendance Records</th><tbody>'
                                );
                                for(var i = powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[0]+1; i <= powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[1]; i++) {
                                    $j('#timeTable').append(
                                            '<tr><td>Student AttendanceCode</td><td>' + attCode + '</td></tr>'
                                    );
                                }
                                $j('#timeTable').append(
                                        '</tbody</table>'
                                );
                            }
                            if(interval){
                                $j('#dayInformation').append(
                                        '<table class="grid" id="intervalTable" style="width:100%"><th colspan=2>Interval Attendance Records</th><tbody>'
                                );
                                for(var i = powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[0]+1; i <= powerTools.adaTroubleshooter.dateEntered.recordNum.split('record')[1]; i++) {
                                    $j('#intervalTable').append(
                                            '<tr><td>Student AttendanceCode</td><td>' + attCode + '</td></tr>'
                                    );
                                }
                                $j('#intervalTable').append(
                                        '</tbody</table>'
                                );
                            }
                        },
                        displayPreviousEnrollments: function(){
                            /* Display student previous enrollment data if it exists using index > 0*/
                            if(powerTools.adaTroubleshooter.studentInfo.length > 1) {
                                $j('#prevEnrollmentData').append(

                                        '<table class="grid" id="studentPrevTable"><th colspan="7" align="center">Previous Enrollments</th>' +
                                        '<tr><td>Entry Date:</td><td>Exit Date:</td><td>Grade Level</td><td>Membership Share</td>' +
                                        '<td>FTE Name</td><td>Attendance Mode</td><td>Attendance Conversion</td></tr>' +
                                        '<tbody id="studentPrevTableBody"></tbody></table>'
                                );
                                for (var i = 1; i < powerTools.adaTroubleshooter.studentInfo.length; i++) {
                                    $j('#studentPrevTableBody').append(
                                            '<tr><td><a href="/admin/students/edittransfer2.html?frn=018' + powerTools.adaTroubleshooter.studentInfo[i].dcid + '">'+
                                                powerTools.adaTroubleshooter.studentInfo[i].entryDate + '</a></td>' +
                                            '<td><a href="/admin/students/edittransfer2.html?frn=018' + powerTools.adaTroubleshooter.studentInfo[i].dcid + '">'+
                                                powerTools.adaTroubleshooter.studentInfo[i].exitDate + '</a></td>' +
                                            '<td>' + powerTools.adaTroubleshooter.studentInfo[i].gradeLevel + '</td>' +
                                            '<td>' + powerTools.adaTroubleshooter.studentInfo[i].membershipShare + '</td>' +
                                            '<td><div class="tooltip">' + powerTools.adaTroubleshooter.studentInfo[i].fteName +
                                            '<span class="tooltiptext"><table id="prevFte' + i + '" class="grid"><th colspan="2">Conversion Info</th>'+
                                            '<tr><td>Period\\Interval\\Code</td><td>Value</td></tr><tbody id="prevFteBody' + i + '" </tbody></table></span></div></td>' +
                                            '<td>' + powerTools.adaTroubleshooter.studentInfo[i].attModeCode + '</td>' +
                                            '<td>' + powerTools.adaTroubleshooter.studentInfo[i].conversionModeCode + '</td></tr>'
                                    );
                                };
                            };
                        },
                    }
                };
        $j(document).ready(function(){
            var today = new Date();
            powerTools.adaTroubleshooter.currentDate.day = today.getDate();
            powerTools.adaTroubleshooter.currentDate.month = today.getMonth() +1;
            powerTools.adaTroubleshooter.currentDate.year = today.getFullYear();
            powerTools.adaTroubleshooter.retrieveStudent();
            powerTools.adaTroubleshooter.retrieveAttendancePrefs();
            powerTools.adaTroubleshooter.buildCalendar();
            powerTools.adaTroubleshooter.buildLegend();
            $j('#dateSelector').on('change', function () {
                var selectedDate = $j('#dateSelector').val().split("/");
                powerTools.adaTroubleshooter.currentDate.month = selectedDate[0];
                powerTools.adaTroubleshooter.currentDate.day = selectedDate[1];
                powerTools.adaTroubleshooter.currentDate.year = selectedDate[2];
                powerTools.adaTroubleshooter.buildCalendar();
            });
            $j(document).on('click', '.square', function(){
                $j('#' + powerTools.adaTroubleshooter.dateEntered.recordNum).attr('style', 'background-color:' +
                        powerTools.adaTroubleshooter.dateEntered.prevColor);
                powerTools.adaTroubleshooter.dateEntered.recordNum = $j(this).attr('id');
                powerTools.adaTroubleshooter.dateEntered.prevColor = $j(this).attr('style').split(':')[1];
                $j(this).attr('style', 'background-color: yellow');
                powerTools.adaTroubleshooter.displayDayInformation();
            });
        });

    </script>
    <style>
        .square {
            width: 14.28%;
            padding-bottom: 8.03%; /* = width for a 1:1 aspect ratio */
        }
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px black;
        }
<style>
    .square {
        width: 14.28%;
        padding-bottom: 8.03%; /* = width for a 1:1 aspect ratio */
    }
    .box{
        float: left;
        width: 20px;
        height: 20px;
        margin: 5px;
        border: 1px solid rgba(0,0,0,.2);
    }
    .yellow{
        background: yellow;
    }
    .tooltip {
        position: relative;
        display: inline-block;
        border-bottom: 1px black;
    }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #000;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            top: 1%;
            left: 225%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 1s;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
~[wc:admin_header_frame_css]
<!-- breadcrumb start -->
<a href="/admin/home.html" target="_top">~[text:psx.html.admin_students.honorroll.start_page]</a>
&gt; <a href="home.html?selectstudent=nosearch" target="_top">~[text:psx.html.admin_students.honorroll.student_selection]</a>
&gt;~[text:psx.html.admin_students.honorroll.honor_roll1]
<!-- breadcrumb end -->
~[wc:admin_navigation_frame_css] ~[wc:title_student_begin_css]ADA Troubleshooter~[wc:title_student_end_css]
<!-- start of content and bounding box -->
<div class="box-round">
    <div id="dateSelection">
        <table class="linkDescList">
            <tb><p><b>This utility will help to determine how Average Daily Attendance and Membership are calculated, should the attendance views
               be updated. If the data your are displaying on this page does not match the ADA/ADM reports, try <a href="/admin/reports_engine/report_w_param.html?ac=reports_get_using_ID;repo_ID=ATT_RefreshPremierMembrDefaults">refreshing
               the Premier Attendance Views Data</a>.
            </b></p></tb>
        </table>
    </div>
    <div id="error"></div>
    <div id="studentAndDailyTables">
        <table>
            <td style="width:50%"><div id="studentData" ></div></td>
            <td style="width:50%"><div id="dayInformation" ></div></td>
        </table>
        <table class="linkDescList"><th colspn =3>Pick A Date<input id="dateSelector" type="text" class="psDateWidget" /></th>
            <tr id="legend"></tr>
        </table>
    </div>
    <div id="attPrefData"></div>
    <table class="linkDescList"><th>Pick A Date<input id="dateSelector" type="text" class="psDateWidget" /></th></table>
    <div id="calendarData" align="center"></div>
    <div id="prevEnrollmentData"></div>
    <div id="calendarLegend"></div>
</div>
<!-- end of content of bounding box -->
~[wc:admin_footer_frame_css]
</body>
</html>
<!-- end right frame -->


